<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, minimum-scale=1.0">
    <title>æ¸¸æˆ6ï¼šåŠ å‡æ³•å°èƒ½æ‰‹</title>
    
    <!-- ğŸ–¼ï¸ å›¾ç‰‡é¢„åŠ è½½ -->
    <link rel="preload" as="image" href="./images/heroes/math-hero-main.png">
    <link rel="preload" as="image" href="./images/heroes/hero-victory.png">
    <link rel="preload" as="image" href="./images/operations/plus-icon.png">
    <link rel="preload" as="image" href="./images/achievements/badge-rookie.png">
    <style>
        /* åŸºç¡€æ ·å¼å’Œç§»åŠ¨ç«¯é€‚é… */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            overflow-x: hidden;
            position: relative;
            touch-action: manipulation;
        }

        /* é˜²æ­¢ç¼©æ”¾å’Œæ»šåŠ¨ */
        body, html {
            overflow-x: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        /* åŠ¨æ€èƒŒæ™¯è£…é¥° */
        .background-shapes {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        .shape {
            position: absolute;
            opacity: 0.1;
            animation: float 6s ease-in-out infinite;
        }

        .shape:nth-child(1) { top: 10%; left: 10%; animation-delay: 0s; }
        .shape:nth-child(2) { top: 20%; right: 10%; animation-delay: -2s; }
        .shape:nth-child(3) { bottom: 30%; left: 15%; animation-delay: -4s; }
        .shape:nth-child(4) { bottom: 10%; right: 20%; animation-delay: -1s; }
        .shape:nth-child(5) { top: 50%; left: 50%; animation-delay: -3s; }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        /* æ¸¸æˆå®¹å™¨ */
        .game-container {
            max-width: 400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            padding: 15px;
            height: calc(100vh - 20px);
            display: flex;
            flex-direction: column;
            position: relative;
            backdrop-filter: blur(10px);
        }

        /* ç§»åŠ¨ç«¯ç«–å±ä¼˜åŒ– */
        @media screen and (orientation: landscape) and (max-height: 500px) {
            .game-container {
                height: calc(100vh - 10px);
                padding: 10px;
                max-width: 95%;
            }
            
            .header h1 {
                font-size: 1.3em;
                margin-bottom: 5px;
            }
            
            .math-hero {
                width: 60px;
                height: 60px;
                font-size: 1.5em;
            }
        }

        /* å¤´éƒ¨åŒºåŸŸ */
        .header {
            text-align: center;
            margin-bottom: 15px;
            position: relative;
        }

        .header h1 {
            color: #4a154b;
            font-size: 1.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            font-weight: bold;
        }

        /* æ•°å­¦è‹±é›„è§’è‰² */
        .math-hero {
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
            animation: heroGlow 2s ease-in-out infinite alternate;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        /* ğŸ–¼ï¸ è‹±é›„å›¾ç‰‡çŠ¶æ€ç®¡ç† */
        .math-hero.image-loaded {
            font-size: 0; /* éšè—emojiæ–‡å­— */
        }
        
        .math-hero.victory {
            background-image: url('./images/heroes/hero-victory.png');
            animation: victoryPulse 1s ease-in-out infinite;
        }
        
        .math-hero.thinking {
            background-image: url('./images/heroes/hero-thinking.png');
        }
        
        .math-hero:not(.image-loaded) {
            background-image: none; /* åå¤‡æ˜¾ç¤ºemoji */
        }

        @keyframes victoryPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes heroGlow {
            0% { box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4); }
            100% { box-shadow: 0 12px 25px rgba(255, 107, 107, 0.6); }
        }

        /* çŠ¶æ€æ  */
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            padding: 8px 15px;
            border-radius: 15px;
            margin-bottom: 15px;
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(78, 205, 196, 0.3);
        }

        .level-info {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .score-info {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .streak-badge {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            min-width: 60px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
        }

        /* æ¸¸æˆä¸»åŒºåŸŸ */
        .game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 10px;
            position: relative;
        }

        /* é¢˜ç›®æ˜¾ç¤ºåŒº */
        .problem-display {
            background: linear-gradient(135deg, #ffd93d, #ffb347);
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(255, 217, 61, 0.4);
            text-align: center;
            width: 100%;
            max-width: 300px;
            position: relative;
            overflow: hidden;
        }

        .problem-display::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            50% { transform: translateX(100%) translateY(100%) rotate(45deg); }
            100% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
        }

        .problem-text {
            font-size: 2.2em;
            color: #4a154b;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 5px;
            position: relative;
            z-index: 1;
        }

        .problem-type {
            font-size: 0.9em;
            color: #8b4513;
            font-weight: bold;
            position: relative;
            z-index: 1;
        }

        /* é€‰é¡¹æŒ‰é’®åŒº */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 100%;
            max-width: 300px;
            margin-bottom: 20px;
        }

        .option-btn {
            background: linear-gradient(45deg, #a8edea, #fed6e3);
            border: none;
            border-radius: 15px;
            padding: 15px;
            font-size: 1.8em;
            font-weight: bold;
            color: #4a154b;
            cursor: pointer;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
            position: relative;
            overflow: hidden;
        }

        .option-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .option-btn:active {
            transform: translateY(0);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .option-btn.correct {
            background: linear-gradient(45deg, #56ab2f, #a8e6cf);
            animation: correctPulse 0.6s ease-in-out;
        }

        .option-btn.wrong {
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            animation: shake 0.5s ease-in-out;
        }

        /* ğŸ¯ æŒ‰é’®èƒŒæ™¯å›¾ç‰‡æ”¯æŒ */
        .option-btn {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .option-btn.button-bg {
            background-image: url('./images/ui/button-bg.png');
        }

        /* â•â– è¿ç®—ç¬¦å›¾æ ‡ */
        .operation-icon {
            width: 50px;
            height: 50px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            display: inline-block;
            margin: 0 10px;
        }

        .operation-icon.plus {
            background-image: url('./images/operations/plus-icon.png');
        }

        .operation-icon.minus {
            background-image: url('./images/operations/minus-icon.png');
        }

        .operation-icon.equals {
            background-image: url('./images/operations/equals-icon.png');
        }

        /* ğŸ† æˆå°±å¾½ç«  */
        .achievement-badge {
            width: 80px;
            height: 80px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            display: inline-block;
            margin: 5px;
        }

        .achievement-badge.rookie {
            background-image: url('./images/achievements/badge-rookie.png');
        }

        .achievement-badge.calculator {
            background-image: url('./images/achievements/badge-calculator.png');
        }

        .achievement-badge.genius {
            background-image: url('./images/achievements/badge-genius.png');
        }

        .achievement-badge.master {
            background-image: url('./images/achievements/badge-master.png');
        }

        .achievement-badge.legend {
            background-image: url('./images/achievements/badge-legend.png');
        }

        .achievement-badge.ultimate {
            background-image: url('./images/achievements/badge-ultimate.png');
        }

        /* â­ UIç‰¹æ•ˆå…ƒç´  */
        .star-effect {
            width: 40px;
            height: 40px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-image: url('./images/ui/star-effect.png');
            display: inline-block;
        }

        .lightning-effect {
            width: 60px;
            height: 30px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-image: url('./images/ui/lightning-effect.png');
            display: inline-block;
        }

        /* ğŸŒŸ è£…é¥°å…ƒç´  */
        .number-particles {
            width: 200px;
            height: 200px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-image: url('./images/decorations/number-particles.png');
            position: absolute;
            opacity: 0.3;
        }

        .formula-trail {
            width: 300px;
            height: 100px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-image: url('./images/decorations/formula-trail.png');
            position: absolute;
            opacity: 0.5;
        }

        .energy-burst {
            width: 150px;
            height: 150px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-image: url('./images/decorations/energy-burst.png');
            position: absolute;
        }

        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* è¿›åº¦æ¡ */
        .progress-container {
            width: 100%;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            height: 8px;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: progressShine 2s infinite;
        }

        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* åé¦ˆæ¶ˆæ¯ */
        .feedback-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            color: white;
            padding: 20px 30px;
            border-radius: 20px;
            font-size: 1.2em;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            opacity: 0;
            scale: 0.5;
            transition: all 0.3s ease;
        }

        .feedback-message.show {
            opacity: 1;
            scale: 1;
        }

        .feedback-message.success {
            background: linear-gradient(45deg, #56ab2f, #a8e6cf);
        }

        .feedback-message.error {
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
        }

        /* ç‰¹æ•ˆå®¹å™¨ */
        .effects-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 999;
        }

        /* ç²’å­æ•ˆæœ */
        .particle {
            position: absolute;
            background: #ffd93d;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            animation: particleFloat 2s ease-out forwards;
        }

        @keyframes particleFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(0);
            }
        }

        /* æç¤ºæŒ‰é’® */
        .hint-btn {
            background: linear-gradient(45deg, #74b9ff, #0984e3);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(116, 185, 255, 0.4);
            transition: all 0.3s ease;
            position: absolute;
            bottom: 20px;
            right: 20px;
            touch-action: manipulation;
        }

        .hint-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(116, 185, 255, 0.6);
        }

        /* æˆå°±è§£é”åŠ¨ç”» */
        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #ffd93d, #ffb347);
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            opacity: 0;
            scale: 0.5;
            transition: all 0.5s ease;
        }

        .achievement-popup.show {
            opacity: 1;
            scale: 1;
        }

        .achievement-popup h3 {
            color: #4a154b;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .achievement-popup p {
            color: #8b4513;
            font-weight: bold;
        }

        /* å…³å¡å®Œæˆåº†ç¥ */
        .level-complete {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1002;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s ease;
        }

        .level-complete.show {
            opacity: 1;
            visibility: visible;
        }

        .level-complete-content {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 30px;
            border-radius: 25px;
            text-align: center;
            color: white;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            transform: scale(0.8);
            transition: transform 0.5s ease;
        }

        .level-complete.show .level-complete-content {
            transform: scale(1);
        }

        .celebration-emoji {
            font-size: 3em;
            margin-bottom: 15px;
            animation: celebrationBounce 1s ease-in-out infinite;
        }

        @keyframes celebrationBounce {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.2) rotate(10deg); }
        }

        .next-level-btn {
            background: linear-gradient(45deg, #ff6b6b, #ffd93d);
            border: none;
            border-radius: 15px;
            padding: 12px 25px;
            color: white;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
            transition: all 0.3s ease;
            touch-action: manipulation;
        }

        .next-level-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.6);
        }

        /* è§¦æ‘¸ä¼˜åŒ– */
        .option-btn, .hint-btn, .next-level-btn {
            min-height: 44px;
            min-width: 44px;
        }

        /* è§¦æ‘¸åé¦ˆ */
        .option-btn:active, .hint-btn:active, .next-level-btn:active {
            transform: scale(0.95);
        }

        /* å±å¹•æ–¹å‘æç¤º */
        @media screen and (orientation: landscape) and (max-height: 500px) {
            .orientation-tip {
                position: fixed;
                top: 10px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(255, 107, 107, 0.9);
                color: white;
                padding: 5px 15px;
                border-radius: 15px;
                font-size: 0.8em;
                z-index: 1003;
                animation: tipPulse 2s infinite;
            }
        }

        @keyframes tipPulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- åŠ¨æ€èƒŒæ™¯ -->
    <div class="background-shapes">
        <div class="shape">ğŸ¯</div>
        <div class="shape">â­</div>
        <div class="shape">ğŸ†</div>
        <div class="shape">ğŸ®</div>
        <div class="shape">ğŸŒŸ</div>
    </div>

    <!-- å±å¹•æ–¹å‘æç¤º -->
    <div class="orientation-tip" id="orientationTip" style="display: none;">
        å»ºè®®ç«–å±ä½¿ç”¨ä»¥è·å¾—æœ€ä½³ä½“éªŒ ğŸ“±
    </div>

    <!-- æ¸¸æˆä¸»å®¹å™¨ -->
    <div class="game-container">
        <!-- å¤´éƒ¨åŒºåŸŸ -->
        <div class="header">
            <div class="math-hero" id="mathHero">ğŸ¦¸</div>
            <h1>åŠ å‡æ³•å°èƒ½æ‰‹</h1>
        </div>

        <!-- çŠ¶æ€æ  -->
        <div class="status-bar">
            <div class="level-info">
                <span>ç¬¬</span>
                <span id="currentLevel">1</span>
                <span>å…³</span>
            </div>
            <div class="score-info">
                <span>åˆ†æ•°: </span>
                <span id="score">0</span>
            </div>
            <div class="streak-badge" id="streakBadge">
                è¿å¯¹ 0
            </div>
        </div>

        <!-- è¿›åº¦æ¡ -->
        <div class="progress-container">
            <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>

        <!-- æ¸¸æˆä¸»åŒºåŸŸ -->
        <div class="game-area">
            <!-- é¢˜ç›®æ˜¾ç¤º -->
            <div class="problem-display">
                <div class="problem-text" id="problemText">å‡†å¤‡å¼€å§‹...</div>
                <div class="problem-type" id="problemType">åŠ å‡æ³•æ··åˆè®­ç»ƒ</div>
            </div>

            <!-- é€‰é¡¹æŒ‰é’® -->
            <div class="options-grid" id="optionsGrid">
                <button class="option-btn" onclick="selectAnswer(0)">?</button>
                <button class="option-btn" onclick="selectAnswer(1)">?</button>
                <button class="option-btn" onclick="selectAnswer(2)">?</button>
                <button class="option-btn" onclick="selectAnswer(3)">?</button>
            </div>
        </div>

        <!-- æç¤ºæŒ‰é’® -->
        <button class="hint-btn" id="hintBtn" onclick="showHint()" title="è·å–æç¤º">ğŸ’¡</button>
    </div>

    <!-- åé¦ˆæ¶ˆæ¯ -->
    <div class="feedback-message" id="feedbackMessage"></div>

    <!-- æˆå°±è§£é”å¼¹çª— -->
    <div class="achievement-popup" id="achievementPopup">
        <h3 id="achievementTitle">ğŸ† æˆå°±è§£é”ï¼</h3>
        <p id="achievementDesc">è¿ç»­ç­”å¯¹5é¢˜ï¼</p>
    </div>

    <!-- å…³å¡å®Œæˆåº†ç¥ -->
    <div class="level-complete" id="levelComplete">
        <div class="level-complete-content">
            <div class="celebration-emoji">ğŸ‰</div>
            <h2>æ­å–œé€šå…³ï¼</h2>
            <p>ä½ å·²ç»æˆä¸ºçœŸæ­£çš„åŠ å‡æ³•å°èƒ½æ‰‹ï¼</p>
            <p>æ­£ç¡®ç‡: <span id="finalAccuracy">0</span>%</p>
            <p>è¿å¯¹çºªå½•: <span id="finalStreak">0</span></p>
            <button class="next-level-btn" onclick="nextLevel()">ä¸‹ä¸€å…³ â†’</button>
        </div>
    </div>

    <!-- ç‰¹æ•ˆå®¹å™¨ -->
    <div class="effects-container" id="effectsContainer"></div>

    <script>
        // ğŸ–¼ï¸ å›¾ç‰‡åŠ è½½ç®¡ç†å™¨
        const ImageManager = {
            images: {
                'hero-main': './images/heroes/math-hero-main.png',
                'hero-victory': './images/heroes/hero-victory.png',
                'hero-thinking': './images/heroes/hero-thinking.png',
                'plus-icon': './images/operations/plus-icon.png',
                'minus-icon': './images/operations/minus-icon.png',
                'equals-icon': './images/operations/equals-icon.png',
                'badge-rookie': './images/achievements/badge-rookie.png',
                'badge-calculator': './images/achievements/badge-calculator.png',
                'badge-genius': './images/achievements/badge-genius.png',
                'badge-master': './images/achievements/badge-master.png',
                'badge-legend': './images/achievements/badge-legend.png',
                'badge-ultimate': './images/achievements/badge-ultimate.png'
            },
            loadedImages: new Set(),
            
            preloadImages() {
                Object.entries(this.images).forEach(([key, src]) => {
                    const img = new Image();
                    img.onload = () => {
                        this.loadedImages.add(key);
                        this.updateImageDisplay(key);
                    };
                    img.onerror = () => {
                        console.log(`å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨emojiåå¤‡: ${src}`);
                    };
                    img.src = src;
                });
            },
            
            updateImageDisplay(imageKey) {
                switch(imageKey) {
                    case 'hero-main':
                        const mathHero = document.querySelector('.math-hero');
                        if (mathHero) {
                            mathHero.style.backgroundImage = `url('${this.images[imageKey]}')`;
                            mathHero.classList.add('image-loaded');
                        }
                        break;
                }
            },
            
            setHeroState(state) {
                const mathHero = document.querySelector('.math-hero');
                if (!mathHero) return;
                
                mathHero.classList.remove('victory', 'thinking');
                
                if (state === 'victory' && this.loadedImages.has('hero-victory')) {
                    mathHero.classList.add('victory', 'image-loaded');
                } else if (state === 'thinking' && this.loadedImages.has('hero-thinking')) {
                    mathHero.classList.add('thinking', 'image-loaded');
                } else if (this.loadedImages.has('hero-main')) {
                    mathHero.style.backgroundImage = `url('${this.images['hero-main']}')`;
                    mathHero.classList.add('image-loaded');
                }
            }
        };

        class MathHeroGame {
            constructor() {
                this.currentLevel = 1;
                this.score = 0;
                this.streak = 0;
                this.maxStreak = 0;
                this.totalQuestions = 0;
                this.correctAnswers = 0;
                this.currentProblem = null;
                this.currentAnswer = null;
                this.options = [];
                this.gameStartTime = Date.now();
                this.problemStartTime = Date.now();
                this.hintsUsed = 0;
                this.isAnswering = false;
                
                // å…³å¡é…ç½®
                this.levels = [
                    { name: "å¯è’™å­¦å¾’", problems: 8, operations: ['add'], range: [0, 5], description: "ç®€å•åŠ æ³•ç»ƒä¹ " },
                    { name: "è¿ç®—æ–°æ‰‹", problems: 10, operations: ['subtract'], range: [0, 5], description: "åŸºç¡€å‡æ³•è®­ç»ƒ" },
                    { name: "æ··åˆæŒ‘æˆ˜", problems: 10, operations: ['add', 'subtract'], range: [0, 6], description: "åŠ å‡æ³•æ··åˆ" },
                    { name: "è¿›é˜¶è®­ç»ƒ", problems: 12, operations: ['add', 'subtract'], range: [0, 8], description: "ä¸­çº§è¿ç®—ç»ƒä¹ " },
                    { name: "é«˜æ‰‹ä¹‹è·¯", problems: 12, operations: ['add', 'subtract'], range: [0, 10], description: "é«˜çº§æ··åˆè¿ç®—" },
                    { name: "æ•°å­¦è¾¾äºº", problems: 15, operations: ['add', 'subtract'], range: [0, 10], description: "å…¨é¢è¿ç®—æŒ‘æˆ˜" },
                    { name: "è®¡ç®—å¤§å¸ˆ", problems: 15, operations: ['add', 'subtract'], range: [0, 10], description: "é€Ÿåº¦ä¸å‡†ç¡®åº¦" },
                    { name: "è¿ç®—ä¸“å®¶", problems: 18, operations: ['add', 'subtract'], range: [0, 10], description: "ä¸“å®¶çº§æŒ‘æˆ˜" },
                    { name: "æ•°å­¦è‹±é›„", problems: 20, operations: ['add', 'subtract'], range: [0, 10], description: "è‹±é›„çº§è¿ç®—" },
                    { name: "ç»ˆæå¤§å¸ˆ", problems: 25, operations: ['add', 'subtract'], range: [0, 10], description: "ç»ˆææŒ‘æˆ˜" }
                ];
                
                this.achievements = [
                    { id: 'first_correct', name: 'åˆæˆ˜å‘Šæ·', desc: 'ç­”å¯¹ç¬¬ä¸€é¢˜', unlocked: false },
                    { id: 'streak_5', name: 'è¿èƒœè¾¾äºº', desc: 'è¿ç»­ç­”å¯¹5é¢˜', unlocked: false },
                    { id: 'streak_10', name: 'è¿èƒœä¸“å®¶', desc: 'è¿ç»­ç­”å¯¹10é¢˜', unlocked: false },
                    { id: 'speed_demon', name: 'é—ªç”µä¾ ', desc: '3ç§’å†…ç­”å¯¹é¢˜ç›®', unlocked: false },
                    { id: 'no_hints', name: 'ç‹¬ç«‹æ€è€ƒ', desc: 'ä¸ä½¿ç”¨æç¤ºå®Œæˆå…³å¡', unlocked: false },
                    { id: 'perfect_round', name: 'å®Œç¾æ— ç¼º', desc: '100%æ­£ç¡®ç‡å®Œæˆå…³å¡', unlocked: false }
                ];

                this.initGame();
                this.checkOrientation();
                this.bindEvents();
            }

            bindEvents() {
                // ç›‘å¬å±å¹•æ–¹å‘å˜åŒ–
                window.addEventListener('orientationchange', () => {
                    setTimeout(() => this.checkOrientation(), 500);
                });
                
                window.addEventListener('resize', () => {
                    this.checkOrientation();
                });

                // é˜²æ­¢é¡µé¢æ»šåŠ¨å’Œç¼©æ”¾
                document.addEventListener('touchstart', (e) => {
                    if (e.touches.length > 1) {
                        e.preventDefault();
                    }
                }, { passive: false });

                document.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                }, { passive: false });

                // é”®ç›˜æ”¯æŒ
                document.addEventListener('keydown', (e) => {
                    if (this.isAnswering) return;
                    
                    const key = e.key;
                    if (key >= '1' && key <= '4') {
                        const optionIndex = parseInt(key) - 1;
                        if (optionIndex < this.options.length) {
                            this.selectAnswer(optionIndex);
                        }
                    } else if (key === 'h' || key === 'H') {
                        this.showHint();
                    }
                });
            }

            checkOrientation() {
                const orientationTip = document.getElementById('orientationTip');
                if (window.innerHeight < 500 && window.innerWidth > window.innerHeight) {
                    orientationTip.style.display = 'block';
                } else {
                    orientationTip.style.display = 'none';
                }
            }

            initGame() {
                this.updateDisplay();
                this.generateNewProblem();
                this.updateMascotMessage("æ¬¢è¿æ¥åˆ°åŠ å‡æ³•å°èƒ½æ‰‹è®­ç»ƒè¥ï¼è®©æˆ‘ä»¬å¼€å§‹æ•°å­¦å†’é™©å§ï¼ ğŸ¯");
            }

            generateNewProblem() {
                if (this.isAnswering) return;
                
                const levelConfig = this.levels[this.currentLevel - 1];
                const operation = levelConfig.operations[Math.floor(Math.random() * levelConfig.operations.length)];
                const [minNum, maxNum] = levelConfig.range;
                
                let a, b, result;
                
                if (operation === 'add') {
                    // ç”ŸæˆåŠ æ³•é¢˜ç›®ï¼Œç¡®ä¿ç»“æœä¸è¶…è¿‡10
                    a = Math.floor(Math.random() * (maxNum - minNum + 1)) + minNum;
                    const maxB = Math.min(maxNum, 10 - a);
                    b = Math.floor(Math.random() * (maxB + 1));
                    result = a + b;
                    this.currentProblem = { text: `${a} + ${b} = ?`, operation: 'add', a, b };
                } else {
                    // ç”Ÿæˆå‡æ³•é¢˜ç›®ï¼Œç¡®ä¿ç»“æœä¸ä¸ºè´Ÿæ•°
                    a = Math.floor(Math.random() * (maxNum - minNum + 1)) + minNum;
                    b = Math.floor(Math.random() * (a + 1)); // bä¸èƒ½å¤§äºa
                    result = a - b;
                    this.currentProblem = { text: `${a} - ${b} = ?`, operation: 'subtract', a, b };
                }
                
                this.currentAnswer = result;
                this.generateOptions();
                this.displayProblem();
                this.problemStartTime = Date.now();
            }

            generateOptions() {
                this.options = [this.currentAnswer];
                
                // ç”Ÿæˆ3ä¸ªé”™è¯¯é€‰é¡¹
                while (this.options.length < 4) {
                    let wrongAnswer = this.currentAnswer + Math.floor(Math.random() * 8) - 4;
                    wrongAnswer = Math.max(0, Math.min(10, wrongAnswer)); // é™åˆ¶åœ¨0-10èŒƒå›´å†…
                    
                    if (!this.options.includes(wrongAnswer)) {
                        this.options.push(wrongAnswer);
                    }
                }
                
                // æ‰“ä¹±é€‰é¡¹é¡ºåº
                this.options = this.shuffleArray(this.options);
            }

            shuffleArray(array) {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            }

            displayProblem() {
                const problemText = document.getElementById('problemText');
                const problemType = document.getElementById('problemType');
                const levelConfig = this.levels[this.currentLevel - 1];
                
                problemText.textContent = this.currentProblem.text;
                problemType.textContent = levelConfig.description;
                
                // æ›´æ–°é€‰é¡¹æŒ‰é’®
                const optionBtns = document.querySelectorAll('.option-btn');
                optionBtns.forEach((btn, index) => {
                    btn.textContent = this.options[index];
                    btn.className = 'option-btn';
                    btn.disabled = false;
                });
            }

            selectAnswer(optionIndex) {
                if (this.isAnswering) return;
                
                this.isAnswering = true;
                const selectedAnswer = this.options[optionIndex];
                const isCorrect = selectedAnswer === this.currentAnswer;
                const answerTime = Date.now() - this.problemStartTime;
                
                this.totalQuestions++;
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                const optionBtns = document.querySelectorAll('.option-btn');
                optionBtns.forEach((btn, index) => {
                    btn.disabled = true;
                    if (index === optionIndex) {
                        btn.className = `option-btn ${isCorrect ? 'correct' : 'wrong'}`;
                    }
                    if (this.options[index] === this.currentAnswer && !isCorrect) {
                        btn.className = 'option-btn correct';
                    }
                });

                if (isCorrect) {
                    this.handleCorrectAnswer(answerTime);
                } else {
                    this.handleWrongAnswer();
                }

                // å»¶è¿Ÿç”Ÿæˆä¸‹ä¸€é¢˜
                setTimeout(() => {
                    this.isAnswering = false;
                    if (this.totalQuestions < this.levels[this.currentLevel - 1].problems) {
                        this.generateNewProblem();
                    } else {
                        this.completeLevel();
                    }
                }, 1500);
            }

            handleCorrectAnswer(answerTime) {
                this.correctAnswers++;
                this.streak++;
                this.maxStreak = Math.max(this.maxStreak, this.streak);
                
                // è®¡ç®—åˆ†æ•°ï¼ˆåŸºç¡€åˆ†10åˆ†ï¼Œè¿å‡»å¥–åŠ±ï¼Œé€Ÿåº¦å¥–åŠ±ï¼‰
                let points = 10;
                points += Math.min(this.streak * 2, 20); // è¿å‡»å¥–åŠ±ï¼Œæœ€å¤š20åˆ†
                if (answerTime < 3000) points += 5; // é€Ÿåº¦å¥–åŠ±
                
                this.score += points;
                
                this.showFeedback('å¤ªæ£’äº†ï¼' + (answerTime < 3000 ? ' ååº”ç¥é€Ÿï¼' : ''), 'success');
                this.createParticleEffect();
                this.updateDisplay();
                
                // ğŸ¦¸ è‹±é›„èƒœåˆ©çŠ¶æ€
                ImageManager.setHeroState('victory');
                
                // æ£€æŸ¥æˆå°±
                this.checkAchievements(answerTime);
                
                // æ›´æ–°è‹±é›„è¡¨æƒ…
                this.updateMascotMessage(this.getEncouragementMessage());
            }

            handleWrongAnswer() {
                this.streak = 0;
                this.showFeedback('å†æƒ³æƒ³çœ‹ï¼æ­£ç¡®ç­”æ¡ˆæ˜¯ ' + this.currentAnswer, 'error');
                this.updateDisplay();
                this.updateMascotMessage("æ²¡å…³ç³»ï¼Œç»§ç»­åŠªåŠ›ï¼æ¯ä¸ªé”™è¯¯éƒ½æ˜¯å­¦ä¹ çš„æœºä¼šï¼ ğŸ’ª");
                
                // ğŸ¦¸ è‹±é›„æ€è€ƒçŠ¶æ€
                ImageManager.setHeroState('thinking');
            }

            getEncouragementMessage() {
                const messages = [
                    "åšå¾—å¾ˆå¥½ï¼ç»§ç»­ä¿æŒï¼ ğŸŒŸ",
                    "ä½ çœŸæ˜¯ä¸ªæ•°å­¦å¤©æ‰ï¼ ğŸ§ ",
                    "å¤ªå‰å®³äº†ï¼ ğŸ‰",
                    "å®Œç¾çš„è®¡ç®—ï¼ âœ¨",
                    "ä½ è¶Šæ¥è¶Šå¼ºäº†ï¼ ğŸ’«",
                    "æ•°å­¦è‹±é›„å°±æ˜¯ä½ ï¼ ğŸ¦¸",
                    "ç»§ç»­è¿™ä¸ªèŠ‚å¥ï¼ ğŸ”¥",
                    "æ™ºæ…§ä¹‹å…‰é—ªé—ªå‘äº®ï¼ ğŸ’"
                ];
                return messages[Math.floor(Math.random() * messages.length)];
            }

            checkAchievements(answerTime) {
                // é¦–æ¬¡ç­”å¯¹
                if (this.correctAnswers === 1 && !this.achievements.find(a => a.id === 'first_correct').unlocked) {
                    this.unlockAchievement('first_correct');
                }
                
                // è¿èƒœæˆå°±
                if (this.streak === 5 && !this.achievements.find(a => a.id === 'streak_5').unlocked) {
                    this.unlockAchievement('streak_5');
                }
                
                if (this.streak === 10 && !this.achievements.find(a => a.id === 'streak_10').unlocked) {
                    this.unlockAchievement('streak_10');
                }
                
                // é€Ÿåº¦æˆå°±
                if (answerTime < 3000 && !this.achievements.find(a => a.id === 'speed_demon').unlocked) {
                    this.unlockAchievement('speed_demon');
                }
            }

            unlockAchievement(achievementId) {
                const achievement = this.achievements.find(a => a.id === achievementId);
                if (achievement && !achievement.unlocked) {
                    achievement.unlocked = true;
                    this.showAchievement(achievement);
                }
            }

            showAchievement(achievement) {
                const popup = document.getElementById('achievementPopup');
                const title = document.getElementById('achievementTitle');
                const desc = document.getElementById('achievementDesc');
                
                title.textContent = `ğŸ† ${achievement.name}`;
                desc.textContent = achievement.desc;
                
                popup.classList.add('show');
                
                setTimeout(() => {
                    popup.classList.remove('show');
                }, 3000);
            }

            completeLevel() {
                const accuracy = Math.round((this.correctAnswers / this.totalQuestions) * 100);
                
                // æ£€æŸ¥å…³å¡ç›¸å…³æˆå°±
                if (this.hintsUsed === 0 && !this.achievements.find(a => a.id === 'no_hints').unlocked) {
                    this.unlockAchievement('no_hints');
                }
                
                if (accuracy === 100 && !this.achievements.find(a => a.id === 'perfect_round').unlocked) {
                    this.unlockAchievement('perfect_round');
                }
                
                // æ˜¾ç¤ºå…³å¡å®Œæˆç•Œé¢
                const levelComplete = document.getElementById('levelComplete');
                const finalAccuracy = document.getElementById('finalAccuracy');
                const finalStreak = document.getElementById('finalStreak');
                
                finalAccuracy.textContent = accuracy;
                finalStreak.textContent = this.maxStreak;
                
                levelComplete.classList.add('show');
            }

            nextLevel() {
                // éšè—å®Œæˆç•Œé¢
                document.getElementById('levelComplete').classList.remove('show');
                
                if (this.currentLevel < this.levels.length) {
                    this.currentLevel++;
                    this.resetLevelStats();
                    this.generateNewProblem();
                    this.updateDisplay();
                    this.updateMascotMessage(`æ¬¢è¿æ¥åˆ°ç¬¬${this.currentLevel}å…³ï¼š${this.levels[this.currentLevel - 1].name}ï¼`);
                } else {
                    this.showGameComplete();
                }
            }

            resetLevelStats() {
                this.totalQuestions = 0;
                this.correctAnswers = 0;
                this.streak = 0;
                this.hintsUsed = 0;
            }

            showGameComplete() {
                // æ˜¾ç¤ºçŸ¥è¯†ç‚¹æ€»ç»“
                this.showKnowledgeSummary();
                
                this.showFeedback('ğŸ‰ æ­å–œä½ ï¼å·²å®Œæˆæ‰€æœ‰å…³å¡ï¼ä½ ç°åœ¨æ˜¯çœŸæ­£çš„åŠ å‡æ³•å¤§å¸ˆäº†ï¼', 'success');
                this.updateMascotMessage("å“‡ï¼ä½ å·²ç»æŒæ¡äº†æ‰€æœ‰çš„åŠ å‡æ³•æŠ€å·§ï¼çœŸæ˜¯å¤ªå‰å®³äº†ï¼ğŸ†");
            }

            showKnowledgeSummary() {
                const totalAccuracy = Math.round((this.correctAnswers / this.totalQuestions) * 100);
                const unlockedAchievements = this.achievements.filter(a => a.unlocked).length;
                
                const summaryHTML = `
                    <div class="knowledge-summary-overlay" id="knowledgeSummary">
                        <div class="knowledge-summary-card">
                            <div class="summary-header">
                                <h3>ğŸ“ çŸ¥è¯†ç‚¹æ€»ç»“</h3>
                                <p>æ­å–œä½ å®Œæˆ"åŠ å‡æ³•å°èƒ½æ‰‹"è®­ç»ƒè¥ï¼</p>
                            </div>
                            
                            <div class="summary-content">
                                <div class="knowledge-section">
                                    <h4>ğŸ§® æŒæ¡çš„æ•°å­¦æŠ€èƒ½</h4>
                                    <ul>
                                        <li><strong>åŠ å‡æ³•æ··åˆè¿ç®—</strong>ï¼šç†Ÿç»ƒæŒæ¡0-10èŒƒå›´å†…åŠ å‡æ³•åˆ‡æ¢</li>
                                        <li><strong>å¿ƒç®—èƒ½åŠ›</strong>ï¼šæå‡äº†æ•°å­¦è¿ç®—çš„é€Ÿåº¦å’Œå‡†ç¡®æ€§</li>
                                        <li><strong>è¿ç®—ç­–ç•¥</strong>ï¼šå­¦ä¼šäº†å¤šç§è§£é¢˜æ€è·¯å’ŒæŠ€å·§</li>
                                        <li><strong>æ•°å­¦æ€ç»´</strong>ï¼šåŸ¹å…»äº†é€»è¾‘æ¨ç†å’Œé—®é¢˜è§£å†³èƒ½åŠ›</li>
                                    </ul>
                                </div>
                                
                                <div class="knowledge-section">
                                    <h4>ğŸ¯ å­¦ä¹ æˆæœç»Ÿè®¡</h4>
                                    <div class="stats-grid">
                                        <div class="stat-item">
                                            <span class="stat-label">å®Œæˆå…³å¡</span>
                                            <span class="stat-value">${this.currentLevel}/${this.levels.length}</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-label">æ€»å¾—åˆ†</span>
                                            <span class="stat-value">${this.score}</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-label">æœ€é«˜è¿å‡»</span>
                                            <span class="stat-value">${this.maxStreak}</span>
                                        </div>
                                        <div class="stat-item">
                                            <span class="stat-label">è§£é”æˆå°±</span>
                                            <span class="stat-value">${unlockedAchievements}/6</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="knowledge-section">
                                    <h4>ğŸ† è·å¾—çš„æˆå°±</h4>
                                    <div class="achievements-list">
                                        ${this.achievements.map(achievement => `
                                            <div class="achievement-item ${achievement.unlocked ? 'unlocked' : 'locked'}">
                                                <span class="achievement-icon">${achievement.unlocked ? 'ğŸ†' : 'ğŸ”’'}</span>
                                                <span class="achievement-name">${achievement.name}</span>
                                                <span class="achievement-desc">${achievement.desc}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                                
                                <div class="knowledge-section">
                                    <h4>ğŸŒŸ ä¸‹ä¸€æ­¥å­¦ä¹ å»ºè®®</h4>
                                    <ul>
                                        <li>æŒ‘æˆ˜20ä»¥å†…çš„è¿›ä½å’Œé€€ä½è¿ç®—</li>
                                        <li>å­¦ä¹ ä¹˜æ³•å’Œé™¤æ³•çš„åŸºç¡€æ¦‚å¿µ</li>
                                        <li>ç»ƒä¹ åº”ç”¨é¢˜å’Œå®é™…é—®é¢˜è§£å†³</li>
                                        <li>æ¢ç´¢æ›´é«˜çº§çš„æ•°å­¦æ¸¸æˆå’ŒæŒ‘æˆ˜</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="summary-footer">
                                <button onclick="closeKnowledgeSummary()" class="summary-close-btn">
                                    âš¡ ç»§ç»­æ•°å­¦å†’é™©
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.insertAdjacentHTML('beforeend', summaryHTML);
                
                // æ·»åŠ æ ·å¼ï¼ˆå¦‚æœè¿˜æ²¡æœ‰çš„è¯ï¼‰
                if (!document.querySelector('#knowledgeSummaryStyles')) {
                    const summaryStyles = `
                        <style id="knowledgeSummaryStyles">
                        .knowledge-summary-overlay {
                            position: fixed;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background: rgba(0, 0, 0, 0.8);
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            z-index: 1000;
                            animation: fadeIn 0.3s ease;
                        }
                        
                        .knowledge-summary-card {
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            border-radius: 20px;
                            max-width: 90%;
                            max-height: 90%;
                            overflow-y: auto;
                            color: white;
                            animation: slideUp 0.5s ease;
                            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                        }
                        
                        .summary-header {
                            text-align: center;
                            padding: 20px 20px 10px;
                            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
                        }
                        
                        .summary-header h3 {
                            margin: 0 0 10px 0;
                            font-size: 1.5em;
                            color: #ffd93d;
                        }
                        
                        .summary-content {
                            padding: 15px 20px;
                        }
                        
                        .knowledge-section {
                            margin-bottom: 20px;
                            background: rgba(255, 255, 255, 0.1);
                            padding: 15px;
                            border-radius: 10px;
                        }
                        
                        .knowledge-section h4 {
                            margin: 0 0 10px 0;
                            color: #ffd93d;
                            font-size: 1.1em;
                        }
                        
                        .knowledge-section ul {
                            margin: 10px 0;
                            padding-left: 20px;
                        }
                        
                        .knowledge-section li {
                            margin-bottom: 8px;
                            line-height: 1.4;
                        }
                        
                        .stats-grid {
                            display: grid;
                            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
                            gap: 10px;
                            margin-top: 10px;
                        }
                        
                        .stat-item {
                            text-align: center;
                            background: rgba(255, 255, 255, 0.2);
                            padding: 10px 5px;
                            border-radius: 8px;
                        }
                        
                        .stat-label {
                            display: block;
                            font-size: 0.8em;
                            margin-bottom: 5px;
                        }
                        
                        .stat-value {
                            display: block;
                            font-size: 1.3em;
                            font-weight: bold;
                            color: #ffd93d;
                        }
                        
                        .achievements-list {
                            display: grid;
                            gap: 8px;
                            margin-top: 10px;
                        }
                        
                        .achievement-item {
                            display: flex;
                            align-items: center;
                            gap: 10px;
                            padding: 8px;
                            background: rgba(255, 255, 255, 0.1);
                            border-radius: 8px;
                            transition: all 0.3s ease;
                        }
                        
                        .achievement-item.unlocked {
                            background: rgba(255, 217, 61, 0.2);
                            border: 1px solid rgba(255, 217, 61, 0.5);
                        }
                        
                        .achievement-item.locked {
                            opacity: 0.6;
                        }
                        
                        .achievement-icon {
                            font-size: 1.2em;
                            width: 25px;
                            text-align: center;
                        }
                        
                        .achievement-name {
                            font-weight: bold;
                            min-width: 80px;
                        }
                        
                        .achievement-desc {
                            font-size: 0.9em;
                            opacity: 0.9;
                        }
                        
                        .summary-footer {
                            padding: 15px 20px 20px;
                            text-align: center;
                        }
                        
                        .summary-close-btn {
                            background: linear-gradient(45deg, #ffd93d, #ffb347);
                            border: none;
                            border-radius: 25px;
                            padding: 12px 30px;
                            font-size: 1.1em;
                            font-weight: bold;
                            color: #4a154b;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            box-shadow: 0 4px 15px rgba(255, 217, 61, 0.4);
                        }
                        
                        .summary-close-btn:hover {
                            transform: translateY(-2px);
                            box-shadow: 0 6px 20px rgba(255, 217, 61, 0.6);
                        }
                        
                        @keyframes fadeIn {
                            from { opacity: 0; }
                            to { opacity: 1; }
                        }
                        
                        @keyframes slideUp {
                            from { transform: translateY(50px); opacity: 0; }
                            to { transform: translateY(0); opacity: 1; }
                        }
                        
                        @keyframes fadeOut {
                            from { opacity: 1; }
                            to { opacity: 0; }
                        }
                        
                        @media (max-width: 500px) {
                            .knowledge-summary-card {
                                max-width: 95%;
                                max-height: 85%;
                            }
                            
                            .summary-header {
                                padding: 15px 15px 10px;
                            }
                            
                            .summary-content {
                                padding: 10px 15px;
                            }
                            
                            .knowledge-section {
                                padding: 10px;
                                font-size: 0.9em;
                            }
                            
                            .stats-grid {
                                grid-template-columns: repeat(2, 1fr);
                            }
                            
                            .achievement-item {
                                flex-direction: column;
                                text-align: center;
                                gap: 5px;
                            }
                            
                            .achievement-name {
                                min-width: auto;
                            }
                        }
                        </style>
                    `;
                    
                    document.head.insertAdjacentHTML('beforeend', summaryStyles);
                }
            }

            showHint() {
                if (this.isAnswering) return;
                
                this.hintsUsed++;
                const problem = this.currentProblem;
                let hintText = '';
                
                if (problem.operation === 'add') {
                    hintText = `æç¤ºï¼š${problem.a} åŠ ä¸Š ${problem.b}ï¼Œå¯ä»¥ç”¨æ‰‹æŒ‡æ•°æ•°å“¦ï¼`;
                } else {
                    hintText = `æç¤ºï¼šä» ${problem.a} ä¸­æ‹¿èµ° ${problem.b}ï¼Œè¿˜å‰©å¤šå°‘å‘¢ï¼Ÿ`;
                }
                
                this.showFeedback(hintText, '');
                this.updateMascotMessage("è®°ä½æç¤ºï¼Œæ…¢æ…¢æ€è€ƒï¼Œä½ ä¸€å®šèƒ½åšå¯¹çš„ï¼ ğŸ¤”");
            }

            createParticleEffect() {
                const container = document.getElementById('effectsContainer');
                const colors = ['#ffd93d', '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4'];
                
                for (let i = 0; i < 12; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * window.innerWidth + 'px';
                    particle.style.top = Math.random() * window.innerHeight + 'px';
                    particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                    particle.style.animationDelay = Math.random() * 0.5 + 's';
                    
                    container.appendChild(particle);
                    
                    setTimeout(() => {
                        container.removeChild(particle);
                    }, 2000);
                }
            }

            showFeedback(message, type) {
                const feedback = document.getElementById('feedbackMessage');
                feedback.textContent = message;
                feedback.className = `feedback-message ${type}`;
                feedback.classList.add('show');
                
                setTimeout(() => {
                    feedback.classList.remove('show');
                }, 2000);
            }

            updateDisplay() {
                document.getElementById('currentLevel').textContent = this.currentLevel;
                document.getElementById('score').textContent = this.score;
                document.getElementById('streakBadge').textContent = `è¿å¯¹ ${this.streak}`;
                
                // æ›´æ–°è¿›åº¦æ¡
                const levelConfig = this.levels[this.currentLevel - 1];
                const progress = (this.totalQuestions / levelConfig.problems) * 100;
                document.getElementById('progressBar').style.width = progress + '%';
            }

            updateMascotMessage(message) {
                const hero = document.getElementById('mathHero');
                hero.title = message;
                
                // æ·»åŠ åŠ¨ç”»æ•ˆæœ
                hero.style.animation = 'none';
                setTimeout(() => {
                    hero.style.animation = 'heroGlow 2s ease-in-out infinite alternate';
                }, 10);
            }
        }

        // å…¨å±€å‡½æ•°
        function selectAnswer(index) {
            window.game.selectAnswer(index);
        }

        function showHint() {
            window.game.showHint();
        }

        function nextLevel() {
            window.game.nextLevel();
        }

        function closeKnowledgeSummary() {
            const summary = document.getElementById('knowledgeSummary');
            if (summary) {
                summary.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    summary.remove();
                }, 300);
            }
        }

        // æ¸¸æˆåˆå§‹åŒ–
        window.addEventListener('DOMContentLoaded', () => {
            // ğŸ–¼ï¸ åˆå§‹åŒ–å›¾ç‰‡ç®¡ç†å™¨
            ImageManager.preloadImages();
            
            window.game = new MathHeroGame();
        });

        // é˜²æ­¢é¡µé¢åˆ·æ–°æ—¶ä¸¢å¤±è¿›åº¦
        window.addEventListener('beforeunload', (e) => {
            if (window.game && window.game.totalQuestions > 0) {
                e.preventDefault();
                e.returnValue = 'ç¡®å®šè¦ç¦»å¼€å—ï¼Ÿæ¸¸æˆè¿›åº¦å°†ä¼šä¸¢å¤±ã€‚';
            }
        });
    </script>
</body>
</html>